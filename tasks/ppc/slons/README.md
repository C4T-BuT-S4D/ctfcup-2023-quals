# ppc | slons

## Information

> Арбалеты Сибири создали лотерею, где зарабатывают огомные деньги. Можно ли ее взломать ?
> 
> `http://slons-afb69872b377a978.ctfcup-2023.ru`

## Deploy

```sh
cd deploy
docker compose -p ella_enchanted up --build -d
```

## Public

No

## TLDR

Just bruteforce)

## Writeup (ru)

В таске нам дан сайт с одной статической html страницей. Если открыть ее код, то мы увидим, что есть две API ручки - `/generate-task` и `/check-task`.

`/generate-task` возвращает `json` из трех чисел `n`, `e` и `c`. По этим числам и названию сайта `RSA Challange` видим, что это алгоритм шифрования [RSA](https://en.wikipedia.org/wiki/RSA_(cryptosystem)), и нам надо расшифровать зашифрованное сообщение.

Однако не зная публичный ключ, это сделать сложно.

После внимательного изучения сайта видим, что там есть [cookie](https://en.wikipedia.org/wiki/HTTP_cookie) с именем `session` и каким-то [base64](https://en.wikipedia.org/wiki/Base64) в значении.

Расшифровав этот base64 любым удобным вам способом видим, что там `json`, в котором есть поля `n`, `e`, и `c`, которые мы уже видели, но и почему-то поле `key`, содержащий почему-то приватный ключ в формате PEM.

Загружаем приватный ключ, и пытаемся расшифровать сообщение. И внезапно видим, что c > n, что ломает большинство библиотек питона.

Дальше есть два пути. Либо взять библиотеку node-rsa, которое умеет такое расшифровывать (как в [solve.js](./solve/solve.js)), либо расшифровывать руками. RSA обладает ограничением - может шифровать сообщения размером не больше `n`. Чтобы его обойти, обычно разбивают сообщение на блоки длины меньше `n`, и шифруют блоки независимо, при этом делая их настолько большими, насколько возможно. Максимальный размер блока, который гарантированно меньше `n`, равен `n // 8` байт. Значит именно на блоки такого размера нам надо разбить, и отдельно расшифровать каждый блок. Реализацию такого алгоритма можно найти в [solve.py](./solve/solve.py). Подробнее про такое разбиение на блоки можно прочитать в [RFC](https://datatracker.ietf.org/doc/html/rfc3447).

Расшифровываем, видим строчку `I placed (тут какое-то число) slons or no`, догадываемся что раз поле в html для числового ввода (хотя и принимает в том числе текст), то надо ввести только это самое число, отправляем его, радуемся.. И не получаем флаг.

Смотрим на сам запрос браузера в developer tools -> network, и видим, что `/check-task` вернул json с ключом `answered`.

Догадываемся, что надо ответить много раз. Пишем скрипт, запускаем, идем пить кофе, возвращаемся, он решил уже 10 тысяч раз, но флага нет. Грустим, думаем дальше. От безысходности начинаем логгировать абсолютно все ответы в файл, перезапускаем скрипт и снова идем пить кофе.

Возвращаемся и видим, что в логах после правильного ответа под номером [1337](https://en.wikipedia.org/wiki/Leet) нам прилетел флаг. Сдерживаемся чтобы не убить автора и сдаем флаг.

## Writeup (en)

Decode the session, decode the message, then send the number

[Exploit](solve/solve.js)

## Domain

slons-afb69872b377a978.ctfcup-2023.ru

## Cloudflare

No

## Flag

ctfcup{a51c8cc4d131a6cbe54bfce654fa9c81}
